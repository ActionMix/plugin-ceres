{% import "Ceres::Widgets.Helper.TwigBuilder" as Twig %}
{% import "Ceres::Widgets.Helper.WidgetHelper" as WidgetHelper %}

{{ Twig.import("LayoutContainer", "Ceres::PageDesign.Macros.LayoutContainer") }}
{{ Twig.component("Ceres::Customer.Components.AddressSelect.AddressHeader") }}
{{ Twig.component("Ceres::MyAccount.Components.ChangePaymentMethod") }}

{% set customClass = widget.settings.customClass.mobile %}
{% set spacingSettings = widget.settings.spacing %}
{% set inlinePadding   = WidgetHelper.getInlineSpacings(spacingSettings, spacingSettings.customPadding.mobile, "") %}
{% set inlineMargin    = WidgetHelper.getInlineSpacings(spacingSettings, "", spacingSettings.customMargin.mobile) %}
{% set spacingPadding  = WidgetHelper.getSpacingClasses(spacingSettings, spacingSettings.customPadding.mobile, "") %}
{% set spacingMargin   = WidgetHelper.getSpacingClasses(spacingSettings, "",spacingSettings.customMargin.mobile) %}
{% set inlinePaddingLR   = WidgetHelper.getInlineSpacings(spacingSettings, spacingSettings.customPadding.mobile, "", ["left", "right"]) %}
{% set spacingPaddingLR  = WidgetHelper.getSpacingClasses(spacingSettings, spacingSettings.customPadding.mobile, "", ["left", "right"]) %}

{% set appearance    = widget.settings.appearance.mobile | default("primary") %}
{% set addressFields = widget.settings.addressFields.mobile | default([
    "title",
    "contactPerson",
    "name1",
    "name2",
    "name3",
    "name4",
    "address1",
    "address2",
    "address3",
    "address4",
    "postalCode",
    "town",
    "country"
]) %}

{{ Twig.if("data") }}
    <div class="widget widget-order-data card widget-{{ appearance | default("success") }}">
        <div class="widget-inner{% if customClass | length > 0 %} {{ customClass }}{% endif %}{% if spacingMargin | length > 0 %} {{ spacingMargin }}{% endif %}"{% if inlineMargin | length > 0 %} style="{{ inlineMargin }}"{% endif %}>
            <div class="h3 pt-3{% if spacingPaddingLR | length > 0 %} {{ spacingPaddingLR }}{% endif %}"{% if inlinePaddingLR | length > 0 %} style="{{ inlinePaddingLR }}"{% endif %}>
                {{ Twig.trans("Ceres::Template.orderConfirmationOrderId") }} {{ Twig.print("data.order.id") }}
            </div>
            <div {% if spacingPadding | length > 0 %}class="{{ spacingPadding }}"{% endif %}{% if inlinePadding | length > 0 %} style="{{ inlinePadding }}"{% endif %}>
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationDate") }}</strong>
                    <span class="col-6 col-sm-7">{{ Twig.print("data.order.createdAt | formatDateTime | date(trans('Ceres::Template.devDateTimeFormat'))") }}</span>
                </div>

                {{ Twig.if("data.status is defined and data.status is not empty") }}
                    <div class="row">
                        <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationStatus") }}</strong>
                        <span class="col-6 col-sm-7">{{ Twig.print("data.status") }}</span>
                    </div>
                {{ Twig.endif() }}
            </div>
    
            <hr class="m-0">
    
            <div{% if spacingPadding | length > 0 %} class="{{ spacingPadding }}"{% endif %}{% if inlinePadding | length > 0 %} style="{{ inlinePadding }}"{% endif %}>
                {{ Twig.set("customerID", "" | json_encode) }}
                {{ Twig.for("date", "data.order.dates", "date.typeId == 8") }}
                    {{ Twig.set("customerID", "date.date") }}
                {{ Twig.endfor() }}

                {{ Twig.if("customerID") }}
                    <div class="row">
                        <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationCustomerID") }}</strong>
                        <span class="col-6 col-sm-7">{{ Twig.print(Twig.call("services.customer.getContactNumber", [Twig.var("data.order.billingAddress.countryId")])) }}</span>
                    </div>   
                {{ Twig.endif() }}
             
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationInvoiceAddress") }}</strong>
                    <span class="col-6 col-sm-7">
                        <div>{{ Twig.print("data.order.billingAddress.name1") }}</div>
                        <div>{{ Twig.print("data.order.billingAddress | addressOptionType(12)") }}</div>
                        <div>{{ Twig.print("data.order.billingAddress.name2") }} {{ Twig.print("data.order.billingAddress.name3") }}</div>
                        <div>{{ Twig.print("data.order.billingAddress.name4") }}</div>
                        <div>{{ Twig.print("data.order.billingAddress.address1") }} {{ Twig.print("data.order.billingAddress.address2") }}</div>
                        <div>{{ Twig.print("data.order.billingAddress.postalCode") }} {{ Twig.print("data.order.billingAddress.town") }}</div>
                        <div>{{ Twig.print(Twig.call("services.country.getCountryName", [Twig.var("data.order.billingAddress.countryId")])) }}</div>
                    </span>
                </div>

                <div class="row mt-3">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationShippingAddress") }}</strong>
                    <span class="col-6 col-sm-7">
                        {{ Twig.if("data.order.billingAddress.id == data.order.deliveryAddress.id") }}
                            <span>
                                {{ Twig.trans("Ceres::Template.orderConfirmationSameAsInvoice") }}
                            </span>
                        {{ Twig.else() }}
                            <span>
                                <div>{{ Twig.print("data.order.deliveryAddress.name1") }}</div>
                                <div>{{ Twig.print("data.order.deliveryAddress | addressOptionType(12)") }}</div>
                                <div>{{ Twig.print("data.order.deliveryAddress.name2") }} {{ Twig.print("data.order.deliveryAddress.name3") }}</div>
                                <div>{{ Twig.print("data.order.deliveryAddress.name4") }}</div>
                                <div>{{ Twig.print("data.order.deliveryAddress.address1") }} {{ Twig.print("data.order.deliveryAddress.address2") }}</div>
                                <div>
                                    {{ Twig.if("data.order.deliveryAddress.address1 == 'PACKSTATION' or data.order.deliveryAddress.address1 == 'POSTFILIALE'") }}
                                        {{ Twig.trans("Ceres::Template.addressPostNummer") }}
                                    {{ Twig.endif() }}
                                    
                                    {{ Twig.print("data.order.deliveryAddress.address3") }}
                                </div>
                                <div>{{ Twig.print("data.order.deliveryAddress.postalCode") }} {{ Twig.print("data.order.deliveryAddress.town") }}</div>
                                <div>{{ Twig.print(Twig.call("services.country.getCountryName", [Twig.var("data.order.deliveryAddress.countryId")])) }}</div>
                            </span>
                        {{ Twig.endif() }}
                    </span>
                </div>
            </div>
    
            <hr class="m-0">

            <div{% if spacingPadding | length > 0 %} class="{{ spacingPadding }}"{% endif %}{% if inlinePadding | length > 0 %} style="{{ inlinePadding }}"{% endif %}>
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationPaymentMethod") }}</strong>
                    <span class="col-6 col-sm-7" id="payment_name_{{ Twig.print("data.order.id") }}">{{ Twig.print("data.paymentMethodName") }}</span>
                </div>
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationPaymentStatus") }}</strong>
                    {{ Twig.set("paymentMethodId", "-1") }}
                    {{ Twig.for("propertyKey", "data.order.properties") }}
                        {{ Twig.if("data.order.properties[loop.index0].typeId == 4") }}
                            {{ Twig.set("paymentStatus", "entry.order.properties[loop.index0].value") }}
                            <span class="col-6 col-sm-7" id="payment_state_{{ Twig.print("data.order.id") }}">{{ Twig.print('trans("Ceres::Template.orderConfirmationPaymentStatus_" ~ data.order.properties[loop.index0].value)') }}</span>
                        {{ Twig.elseif("data.order.properties[loop.index0].typeId == 3") }}
                            {{ Twig.set("paymentMethodId", "data.order.properties[loop.index0].value") }}
                        {{ Twig.endif() }}
                    {{ Twig.endfor() }}
                </div>

                {{ Twig.set("currentTemplate", Twig.call("services.template.getCurrentTemplate")) }}

                {{ Twig.if("paymentMethodId != -1 and showAdditionalPaymentInformation == true") }}
                    <change-payment-method
                        :current-order="{{ Twig.print("data.order | json_encode") }}"
                        :change-possible="{{ Twig.print(Twig.call("services.order.allowPaymentMethodSwitchFrom", [Twig.var("paymentMethodId"), Twig.var("data.order.id")]) ~ " | json_encode") }}"
                        :allowed-payment-methods="{{ Twig.print(Twig.call("services.order.getPaymentMethodListForSwitch", [Twig.var("paymentMethodId"), Twig.var("data.order.id")]) ~ " | json_encode") }}"
                        :payment-status="{{ Twig.print("paymentStatus | json_encode") }}"
                        :current-payment-method-name="{{ Twig.print("data.paymentMethodName | json_encode") }}"
                        :current-template="{{ Twig.print("currentTemplate | json_encode") }}">
                    </change-payment-method>
                {{ Twig.endif() }}

                {{ Twig.print(Twig.call("LayoutContainer.show", ["Ceres::OrderConfirmation.AdditionalPaymentInformation", "data.order"])) }}

            </div>

            <hr class="m-0">
    
            <div{% if spacingPadding | length > 0 %} class="{{ spacingPadding }}"{% endif %}{% if inlinePadding | length > 0 %} style="{{ inlinePadding }}"{% endif %}>
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationShippingProfile") }}</strong>
                    <span class="col-6 col-sm-7">{{ Twig.print("data.shippingProvider") }} - {{ Twig.print("data.shippingProfileName") }}</span>
                </div>
                
                {{ Twig.set("shippingDate", "" | json_encode) }}
                {{ Twig.for("date", "data.order.dates", "date.typeId == 8") }}
                    {{ Twig.set("shippingDate", "date.date") }}
                {{ Twig.endfor() }}

                {{ Twig.if("shippingDate") }}
                    <div class="row">
                        <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationEstimatedShippingDate") }}</strong>
                        <span class="col-6 col-sm-7">{{ Twig.print("shippingDate | date(Twig.trans('Ceres::Template.devDateFormat'))") }}</span>
                    </div>
                {{ Twig.endif() }}

                {{ Twig.print(Twig.call("LayoutContainer.show", ["Ceres::OrderConfirmation.AdditionalShippingInformation", "data.order"])) }}
                
            </div>
        </div>
    </div>
{{ Twig.else() }}
<div>twig if false</div>
{{ Twig.endif() }}
