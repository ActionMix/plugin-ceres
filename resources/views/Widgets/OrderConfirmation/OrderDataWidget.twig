{% import "Ceres::Widgets.Helper.TwigBuilder" as Twig %}
{% import "Ceres::Widgets.Helper.WidgetHelper" as WidgetHelper %}

{{ Twig.import("LayoutContainer", "Ceres::PageDesign.Macros.LayoutContainer") }}
{{ Twig.component("Ceres::MyAccount.Components.ChangePaymentMethod") }}

<div class="widget widget-order-data">
    <div class="card small">
        <!-- ORDER -->
        <div class="card-header">
            <h5>{{ Twig.trans("Ceres::Template.orderConfirmationOrderId") }} {{ Twig.print("data.order.id") }}</h5>
        </div>
        <div class="card-body">
            <div class="details">
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationDate") }}</strong>
                    TODO: testen
                    <span class="col-6 col-sm-7">{{ Twig.print("data.order.createdAt | formatDateTime | date(trans('Ceres::Template.devDateTimeFormat'))") }}</span>
                </div>

                {{ Twig.if("data.status is defined and data.status is not empty") }}
                    <div class="row">
                        <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationStatus") }}</strong>
                        <span class="col-6 col-sm-7">{{ Twig.print("data.status") }}</span>
                    </div>
                {{ Twig.endif() }}
            </div>

            <hr>

            <div>
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationInvoiceAddress") }}</strong>
                    <span class="col-6 col-sm-7">
                        <div>{{ Twig.print("data.order.billingAddress.name1") }}</div>
                        <div>{#{ Twig.print("data.order.billingAddress | addressOptionType(12)") }#}</div>
                        <div>{{ Twig.print("data.order.billingAddress.name2") }} {{ Twig.print("data.order.billingAddress.name3") }}</div>
                        <div>{{ Twig.print("data.order.billingAddress.name4") }}</div>
                        <div>{{ Twig.print("data.order.billingAddress.address1") }} {{ Twig.print("data.order.billingAddress.address2") }}</div>
                        <div>{{ Twig.print("data.order.billingAddress.postalCode") }} {{ Twig.print("data.order.billingAddress.town") }}</div>
                        <div>
                            {{ Twig.if("true and data.order.billingAddress.countryId") }}
                                {{ Twig.print(Twig.call("services.country.getCountryName", [Twig.var("data.order.billingAddress.countryId")])) }}
                            {{ Twig.endif() }}
                        </div>
                    </span>
                </div>

                <div class="row mt-3">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationShippingAddress") }}</strong>
                    <span class="col-6 col-sm-7">
                        {{ Twig.if("data.order.billingAddress.id == data.order.deliveryAddress.id") }}
                            <span>
                                {{ Twig.trans("Ceres::Template.orderConfirmationSameAsInvoice") }}
                            </span>
                        {{ Twig.else() }}
                            <span>
                                <div>{{ Twig.print("data.order.deliveryAddress.name1") }}</div>
                                <div>{#{ Twig.print("data.order.deliveryAddress | addressOptionType(12)") }#}</div>
                                <div>{{ Twig.print("data.order.deliveryAddress.name2") }} {{ Twig.print("data.order.deliveryAddress.name3") }}</div>
                                <div>{{ Twig.print("data.order.deliveryAddress.name4") }}</div>
                                <div>{{ Twig.print("data.order.deliveryAddress.address1") }} {{ Twig.print("data.order.deliveryAddress.address2") }}</div>
                                <div>
                                    {{ Twig.if("data.order.deliveryAddress.address1 == 'PACKSTATION' or data.order.deliveryAddress.address1 == 'POSTFILIALE'") }}
                                        {{ Twig.trans("Ceres::Template.addressPostNummer") }}
                                    {{ Twig.endif() }}
                                    
                                    {{ Twig.print("data.order.deliveryAddress.address3") }}
                                </div>
                                <div>{{ Twig.print("data.order.deliveryAddress.postalCode") }} {{ Twig.print("data.order.deliveryAddress.town") }}</div>
                                <div>
                                    {{ Twig.if("true and data.order.deliveryAddress.countryId") }}
                                        {{ Twig.print(Twig.call("services.country.getCountryName", [Twig.var("data.order.deliveryAddress.countryId")])) }}
                                    {{ Twig.endif() }}
                                </div>
                            </span>
                        {{ Twig.endif() }}
                    </span>
                </div>
            </div>

            <hr>

            <div>
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationPaymentMethod") }}</strong>
                    <span class="col-6 col-sm-7" id="payment_name_{{ Twig.print("data.order.id") }}">{{ Twig.print("data.paymentMethodName") }}</span>
                </div>
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationPaymentStatus") }}</strong>
                    {{ Twig.set("paymentMethodId", "-1") }}
                    {{ Twig.for("propertyKey", "data.order.properties") }}
                        TODO: loopIndex testen
                        {{ Twig.if("data.order.properties[loop.index0].typeId == 4") }}
                            {{ Twig.set("paymentStatus", "entry.order.properties[loop.index0].value") }}
                            TODO: funktioniert das?
                            <span class="col-6 col-sm-7" id="payment_state_{{ Twig.print("data.order.id") }}">{{ Twig.trans("Ceres::Template.orderConfirmationPaymentStatus_" ~ Twig.print("data.order.properties[loop.index0].value")) }}</span>
                        {{ Twig.elseif("data.order.properties[loop.index0].typeId == 3") }}
                            {{ Twig.set("paymentMethodId", "data.order.properties[loop.index0].value") }}
                        {{ Twig.endif() }}
                    {{ Twig.endfor() }}
                </div>

                {{ Twig.set("currentTemplate", Twig.call("services.template.getCurrentTemplate")) }}

                {{ Twig.if("paymentMethodId != -1 and showAdditionalPaymentInformation == true") }}
                    <change-payment-method
                        :current-order="{{ Twig.print("data.order | json_encode") }}"
                        :change-possible="{{ Twig.print(Twig.call("services.order.allowPaymentMethodSwitchFrom", [Twig.var("paymentMethodId"), Twig.var("data.order.id")]) ~ " | json_encode") }}"
                        :allowed-payment-methods="{{ Twig.print(Twig.call("services.order.getPaymentMethodListForSwitch", [Twig.var("paymentMethodId"), Twig.var("data.order.id")]) ~ " | json_encode") }}"
                        :payment-status="{{ Twig.print("paymentStatus | json_encode") }}"
                        :current-payment-method-name="{{ Twig.print("data.paymentMethodName | json_encode") }}"
                        :current-template="{{ Twig.print("currentTemplate | json_encode") }}">
                    </change-payment-method>
                {{ Twig.endif() }}

                {{ Twig.print(Twig.call("LayoutContainer.show", ["Ceres::OrderConfirmation.AdditionalPaymentInformation", "data.order"])) }}

            </div>

            <hr>

            <div>
                <div class="row">
                    <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationShippingProfile") }}</strong>
                    <span class="col-6 col-sm-7">{{ Twig.print("data.shippingProvider") }} - {{ Twig.print("data.shippingProfileName") }}</span>
                </div>
                
                TODO: testen                
                {{ Twig.set("shippingDate", "" | json_encode) }}
                {{ Twig.for("date", "data.order.dates", "date.typeId == 8") }}
                    {{ Twig.set("shippingDate", "date.date") }}
                {{ Twig.endfor() }}

                {{ Twig.if("shippingDate") }}
                    <div class="row">
                        <strong class="col-6 col-sm-5">{{ Twig.trans("Ceres::Template.orderConfirmationEstimatedShippingDate") }}</strong>
                        <span class="col-6 col-sm-7">{{ Twig.print("shippingDate | date(Twig.trans('Ceres::Template.devDateFormat'))") }}</span>
                    </div>
                {{ Twig.endif() }}

                {{ Twig.print(Twig.call("LayoutContainer.show", ["Ceres::OrderConfirmation.AdditionalShippingInformation", "data.order"])) }}
                
            </div>

        </div>
        <!-- ORDER -->
    </div>
</div>
